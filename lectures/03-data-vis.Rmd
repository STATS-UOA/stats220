---
title: "STATS 220"
subtitle: "Data visualisation`r emo::ji('bar_chart')`"
type: "lecture"
date: ""
output:
  xaringan::moon_reader:
    css: ["assets/remark.css"]
    lib_dir: libs
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r initial, echo = FALSE, cache = FALSE, results = 'hide'}
library(knitr)
options(htmltools.dir.version = FALSE, htmltools.preserve.raw = FALSE,
  tibble.width = 60, tibble.print_min = 6)
opts_chunk$set(
  echo = TRUE, warning = FALSE, message = FALSE, comment = "#>",
  fig.path = 'figure/', cache.path = 'cache/', cache = TRUE,
  fig.align = 'center', fig.width = 12, fig.height = 8.5, fig.show = 'hold',
  dpi = 120
)
```

```{r xaringan-panelset, echo = FALSE}
xaringanExtra::use_panelset()
```

```{r external, include = FALSE, cache = FALSE}
read_chunk('R/03-data-vis.R')
```

.pull-left[
<br>
> The greatest value of a picture is when it forces us to notice what we never expected to see.
> <br> -- [John W. Tukey](https://en.wikipedia.org/wiki/John_Tukey)
]
.pull-right[
<br>
.center[<img src="img/eda.jpg" height="100%">]
]

---

## numbers vs plots

.pull-left[
```{r numbers, echo = 4}
```
]

--

.pull-right[
```{r plots, fig.width = 4, fig.height = 4, echo = FALSE}
```
]

---

## numbers vs plots

<img src="https://github.com/stephlocke/lazyCDN/blob/master/DinoSequential.gif?raw=true" width="100%">

.footnote[image credit: Steph Locke]

---

class: middle inverse

## Charts `r emo::ji("boxing_glove")` Graphics

---

## A toy example

<br>
.pull-left[
```{r toy-df, echo = 5}
```
]
.pull-right[
* `dept`: discrete/categorical
* `count`: quantitative/numeric
<hr>
What types of plots can we make?
1. bar plot for counts
2. pie chart for proportions
]

---

## Named charts

.pull-left[
* Bar plot
```{r base-barplot, fig.width = 4, fig.height = 4}
```
]
.pull-right[
* Pie chart
```{r base-pieplot, fig.width = 4, fig.height = 4}
```
]

---

## Seems convenient, but ...

<br>
.pull-left[
.x[
* a limited set of named charts
* single purpose functions
* inconsistent inputs
]
]
.pull-right[
```{r ref.label = "base-barplot", eval = FALSE}
```
```{r ref.label = "base-pieplot", eval = FALSE}
```
]

---

.pull-left[
<br>
<br>
.center[<img src="img/gg.jpg" width="300px">]
]
.pull-right[
> Grammar makes language expressive. A language consisting of words and no grammar (statement = word) expresses only as many ideas as there are words. By specifying how words are combined in statements, a grammar expands a languageâ€™s scope.
]

---

class: inverse

background-image: url(img/named-gg.png)
background-size: cover

.footnote[image credit: Thomas Lin Pederson]

---

class: inverse middle

### The *grammar of graphics* takes us beyond a limited set of .blue[charts (words)] to an almost unlimited world of .blue[graphical forms (statements)]. 
<hr>
### *{ggplot2}* provides a cohesive system for declaratively creating elegant graphics, based on The Grammar of Graphics.

---

.pull-left[
```{r gg-col, fig.width = 4, fig.height = 3.5}
```
]
.pull-right[
```{r gg-pie, fig.width = 4, fig.height = 4}
```
]

---

## A graphing template

```r
ggplot(data = <DATA>, mapping = aes(<MAPPINGS>)) +
  layer(geom = <GEOM>, stat = <STAT>, position = <POSITION>) +
  layer(geom = <GEOM>, stat = <STAT>, position = <POSITION>)
```

1. `data`: tibble.
2. `mapping`: aesthetic mappings between data variables and visual elements.
3. `layer()`: a graphical layer is a combination of data, stat and geom with a potential position adjustment.
  * `geom`: geometric elements to render each data observation.
  * `stat`: statistical transformations applied to the data.
  * `position`: position adjustment, such as "identity", "stack", "dodge" etc.

---

## Layer

```{r gg-layer, fig.height = 3.8, fig.width = 4}
```

---

## Aesthetic mapping: positional

```{r aes-map, fig.height = 3.8, fig.width = 4}
```

---

## Geom .small[(a shorthand to `layer()`)]

.pull-left[
```{r gg-bar, fig.height = 3.8, fig.width = 4}
```
]
.pull-right[
```{r gg-col2, eval = FALSE}
```
* `stat = "identity"` leaves data as is.
* `geom_col()` is a shortcut to `geom_bar(stat = "identity")`.

**Generally, we use `geom_*()` instead of `layer()` in practice.**
]

---

## Geom

.pull-left[
.small[
```{r gg-point, fig.height = 3.8, fig.width = 4}
```
]
]
.pull-right[
.small[
```{r gg-seg, fig.height = 3.8, fig.width = 4}
```
]
]

---

## Composite geoms: lollipop `r emo::ji("lollipop")` = points + segments

```{r gg-pop, fig.height = 3.5, fig.width = 4}
```

---

## Geom catalogue

```{r geom, echo = FALSE}
geoms <- help.search("^geom_", package = "ggplot2")
geoms$matches %>% 
  select(Entry, Title) %>% 
  group_by(Title) %>% 
  mutate(col = paste0("C", 1:n())) %>% 
  ungroup() %>% 
  pivot_wider(names_from = col, values_from = Entry) %>% 
  mutate(geom = paste(C1, C2, C3, C4, sep = ", "),
         geom = gsub(", NA", "", geom)) %>% 
  select(geom, Title) %>% 
  DT::datatable(colnames = c("geom", "Description"),
                rownames = FALSE,
                options = list(dom = 'tp', ordering=FALSE, pageLength = 5,
                               width = "80%")) 
```

.footnote[<https://ggplot2.tidyverse.org/reference/index.html#section-layers>]

---

## Stat

.pull-left[
* Aggregated (pre-computed)
```{r ref.label = "toy-df", echo = 5}
```
]
.pull-right[
* Disaggregated
```{r sci-disaggregated, echo = 2}
```
]

---

## Stat

.pull-left[
```{r ref.label = "gg-bar", fig.height = 4, fig.width = 4}
```
]
.pull-right[
```{r gg-bar-c, fig.height = 4, fig.width = 4}
```
]

---

## Aesthetic mapping: visual

.pull-left[
```{r gg-bar-col, fig.height = 4, fig.width = 4}
```
]
.pull-right[
```{r gg-bar-fill, fig.height = 4, fig.width = 4}
```
]

---

## Mapping variables vs Setting constants

.pull-left[
```{r ref.label = "gg-bar-fill", fig.height = 4, fig.width = 4}
```
]
.pull-right[
```{r gg-bar-fill-str, fig.height = 4, fig.width = 4}
```
]

---

## Visual aesthetics

.pull-left[
* `colour`/`color`, `fill`:
  + named colours, e.g. `"red"`
  + RGB specification, e.g. `"#756bb1"`
* `alpha`: opacity between 0 and 1
* `shape`:
  * an integer between 0 and 25
  * a single string, e.g. `"triangle open"`
* `linetype`: 
  * an integer between 0 and 6
  * a single string, e.g. `"dashed"`
* `size`, `radius`: a numerical value (in millimetres)
]
.pull-right[
<br>
<br>
<img src="https://ggplot2.tidyverse.org/reference/scale_shape-6.png" width="100%">
]

---

## Coord

```{r gg-arc, fig.height = 5, fig.width = 5}
```

---

## Theme: modify the look

```{r gg-theme, fig.height = 3.5, fig.width = 6}
```

---

## Modify the look of *texts* with `element_text()`

<img src="img/ggplot-theme-text-annotation.png" width="100%">

---

## Modify the look of

.pull-left[
.center[**lines** with `element_line()`]

<img src="img/ggplot-annotated-line-marks.png" width="100%">
]
.pull-right[
.center[**regions** with `element_rect()`]

<img src="img/ggplot-annotated-rect-marks.png" width="100%">
]

---

class: middle inverse

## Small multiples .small[(or trellis/faceting plots)]

### `r emo::ji("star2")` the idea of conditioning on the values taken on by one or more of the variables in a data set

---

.left-column[
## Facet
]
.right-column[
`mpg` data available from {ggplot2}
```{r mpg}
```
]

---

.left-column[
## Facet
]
.right-column[
```{r gg-mpg, fig.width = 5, fig.height = 4}
```
]

---

.left-column[
## Facet
### - `facet_grid()`
]
.right-column[
```{r gg-facet-rows, fig.width = 5, fig.height = 4}
```
]

---

.left-column[
## Facet
### - `facet_grid()`
]
.right-column[
```{r gg-facet-cols, fig.width = 6, fig.height = 4}
```
]

---

.left-column[
## Facet
### - `facet_grid()`
]
.right-column[
```{r gg-facet-grid, fig.width = 7, fig.height = 4}
```
]

---

.left-column[
## Facet
### - `facet_grid()`
### - `facet_wrap()`
]
.right-column[
```{r gg-facet-wrap, fig.width = 6, fig.height = 4}
```
]

---

class: middle inverse

## Exploratory data visualisation

---

background-image: url(img/data-vis-log.png)
background-size: contain

.footnote[image credit: Emi Tanaka]

---

.left-column[
## case study
### - import
]
.right-column[
```{r movies}
```
]

---

.left-column[
## case study
### - import
### - glimpse
]
.right-column[
.small[
```{r skim-movies, render = knitr::normal_print}
```
]
]

---

.left-column[
## case study
### - import
### - glimpse
### - vis
]
.right-column[
Q: are movies ratings consistent b/t IMDB & Rotten Tomatoes?
.small[
```{r movies-gam, fig.height = 3.5, fig.width = 3.5}
```
]
]

---

.left-column[
## case study
### - import
### - glimpse
### - vis
]
.right-column[
Q: are movies ratings consistent b/t IMDB & Rotten Tomatoes?
.small[
```{r movies-hex, fig.height = 3.5, fig.width = 3.5}
```
]
]

---

.left-column[
## case study
### - import
### - glimpse
### - vis
]
.right-column[
Q: the popularity of major genre.
.small[
```{r movies-bar, fig.height = 3.5, fig.width = 5}
```
]
]

---

.left-column[
## case study
### - import
### - glimpse
### - vis
]
.right-column[
Q: the likeness of major genre.
.small[
```{r movies-boxplot, fig.height = 3.5, fig.width = 5}
```
]
]

---

.left-column[
## case study
### - import
### - glimpse
### - vis
]
.right-column[
Q: the likeness of major genre.
.small[
```{r movies-density, fig.height = 3.5, fig.width = 6}
```
]
]

---

.left-column[
## case study
### - import
### - glimpse
### - vis
]
.right-column[
Q: the likeness of major genre.
.small[
```{r movies-ridges, fig.height = 3.5, fig.width = 7}
```
]
]

---

## Beyond {ggplot2}

> {ggplot2} now has an official extension mechanism. This means that others can now easily create their own stats, geoms and positions, and provide them in other packages. This should allow the ggplot2 community to flourish, even as less development work happens in ggplot2 itself. 

`r emo::ji("arrow_right")` <https://exts.ggplot2.tidyverse.org/gallery/>

---

## Reading

.pull-left[
.center[[<img src="https://d33wubrfki0l68.cloudfront.net/b88ef926a004b0fce72b2526b0b5c4413666a4cb/24a30/cover.png" height="520px">](https://r4ds.had.co.nz)]
]
.pull-right[
* [Data visualisation](https://r4ds.had.co.nz/data-visualisation.html)
]
