<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>STATS 220</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="libs/str_view/str_view.css" rel="stylesheet" />
    <script src="libs/str_view-binding/str_view.js"></script>
    <link rel="stylesheet" href="assets/remark.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# STATS 220
## Working with text🔡

---


class: inverse middle







## String manipulation

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - create
]
.right-column[
## Fixed pattern
Create strings with `'` or `"`

```r
library(tidyverse) # library(stringr)
string &lt;- "lzDHk3orange2o5ghte"
string
```

```
#&gt; [1] "lzDHk3orange2o5ghte"
```

```r
fruit &lt;- c("cherry", "banana")
fruit
```

```
#&gt; [1] "cherry" "banana"
```
]

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - create
### - join
]
.right-column[
## Fixed pattern
Join strings

```r
c(string, fruit)
```

```
#&gt; [1] "lzDHk3orange2o5ghte" "cherry"              "banana"
```

```r
str_c(string, fruit, sep = ", ")
```

```
#&gt; [1] "lzDHk3orange2o5ghte, cherry" "lzDHk3orange2o5ghte, banana"
```

```r
str_c(string, fruit, collapse = ", ")
```

```
#&gt; [1] "lzDHk3orange2o5ghtecherry, lzDHk3orange2o5ghtebanana"
```
]

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - create
### - join
### - detect
]
.right-column[
## Fixed pattern
Determine which strings match a pattern

```r
str_detect(string, "orange")
```

```
#&gt; [1] TRUE
```

```r
str_detect(fruit, "orange")
```

```
#&gt; [1] FALSE FALSE
```
]

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - create
### - join
### - detect
### - locate
]
.right-column[
## Fixed pattern
Find the positions of matches

```r
str_locate(string, "orange")
```

```
#&gt;      start end
#&gt; [1,]     7  12
```

```r
str_locate(fruit, "orange")
```

```
#&gt;      start end
#&gt; [1,]    NA  NA
#&gt; [2,]    NA  NA
```
]

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - create
### - join
### - detect
### - locate
### - extract
]
.right-column[
## Fixed pattern
Extract the content of matches

```r
str_sub(string, 7, 12)
```

```
#&gt; [1] "orange"
```

```r
str_extract(string, "orange")
```

```
#&gt; [1] "orange"
```

```r
str_extract(fruit, "orange")
```

```
#&gt; [1] NA NA
```
]

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - create
### - join
### - detect
### - locate
### - extract
### - replace
]
.right-column[
## Fixed pattern
Replace matches with new values

```r
str_replace(string, "orange", "apple")
```

```
#&gt; [1] "lzDHk3apple2o5ghte"
```

```r
str_replace(fruit, "orange", "apple")
```

```
#&gt; [1] "cherry" "banana"
```
]

---

class: inverse middle

## Regular expressions .blue[.small[.small[(aka regex/regexp)]]]
### an extremely concise language for describing patterns

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - dot
]
.right-column[
## Regex
`.` matches any character (except a newline)

```r
str_extract(string, "o....e")
```

```
#&gt; [1] "orange"
```

```r
str_extract_all(string, "o....e")
```

```
#&gt; [[1]]
#&gt; [1] "orange" "o5ghte"
```
]

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - dot
### - qualifier
]
.right-column[
## Regex
repeation

```r
str_extract_all(string, "o.{4}e")
```

```
#&gt; [[1]]
#&gt; [1] "orange" "o5ghte"
```

```r
str_extract_all(string, "o.*e")
```

```
#&gt; [[1]]
#&gt; [1] "orange2o5ghte"
```

```r
str_extract_all(string, "o.*?e")
```

```
#&gt; [[1]]
#&gt; [1] "orange" "o5ghte"
```
]

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - dot
### - qualifier
]
.right-column[
## Regex
repeation
+ `?`: 0 or 1
+ `+`: 1 or more
+ `*`: 0 or more
+ `{n}`: exactly n
+ `{n,}`: n or more
+ `{,m}`: at most m
+ `{n,m}`: between n and m
]

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - dot
### - qualifier
### - escape
]
.right-column[
## Regex
if `.` matches any character, how to match a literal `"."`?
* use the backslash `\` to escape special behaviour `\.`
* `\` is also used as an escape symbol in strings
* end up using .brown[`"\\\\."`] to create the regular expression `\.`

```r
str_view_all(string, "o\\.{4}e")
```

<div id="htmlwidget-927c8b8dbf5fcd76b834" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-927c8b8dbf5fcd76b834">{"x":{"html":"<ul>\n  <li>lzDHk3orange2o5ghte<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view_all("a.b.c", "\\.")
```

<div id="htmlwidget-945213d3237066ea2799" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-945213d3237066ea2799">{"x":{"html":"<ul>\n  <li>a<span class='match'>.<\/span>b<span class='match'>.<\/span>c<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - dot
### - qualifier
### - escape
### - meta
]
.right-column[
## Regex
* `\d`: matches any digit.
* `\s`: matches any whitespace (e.g. space, tab `\t`, newline `\n`).
* `[abc]`: matches a, b, or c.

```r
str_view_all(string, "\\d")
```

<div id="htmlwidget-cdf2f05a9d1c5c8f150f" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-cdf2f05a9d1c5c8f150f">{"x":{"html":"<ul>\n  <li>lzDHk<span class='match'>3<\/span>orange<span class='match'>2<\/span>o<span class='match'>5<\/span>ghte<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view_all(string, "[0-9]")
```

<div id="htmlwidget-4aac3c09d02a11340749" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-4aac3c09d02a11340749">{"x":{"html":"<ul>\n  <li>lzDHk<span class='match'>3<\/span>orange<span class='match'>2<\/span>o<span class='match'>5<\/span>ghte<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]

???

* a lowercase letter will select any of the things it stands for (so `\d` selects any digit, while `\s` will select any blank space)

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - dot
### - qualifier
### - escape
### - meta
]
.right-column[
## Regex
* `\D`: matches anything except digits.
* `\S`: matches anything except whitespaces.
* `[^abc]`: matches anything except a, b, or c.

```r
str_view_all(string, "\\D")
```

<div id="htmlwidget-5d9f9ef9d58f5977ce3a" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-5d9f9ef9d58f5977ce3a">{"x":{"html":"<ul>\n  <li><span class='match'>l<\/span><span class='match'>z<\/span><span class='match'>D<\/span><span class='match'>H<\/span><span class='match'>k<\/span>3<span class='match'>o<\/span><span class='match'>r<\/span><span class='match'>a<\/span><span class='match'>n<\/span><span class='match'>g<\/span><span class='match'>e<\/span>2<span class='match'>o<\/span>5<span class='match'>g<\/span><span class='match'>h<\/span><span class='match'>t<\/span><span class='match'>e<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view_all(string, "[^0-9]")
```

<div id="htmlwidget-75dc002e42d896afef14" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-75dc002e42d896afef14">{"x":{"html":"<ul>\n  <li><span class='match'>l<\/span><span class='match'>z<\/span><span class='match'>D<\/span><span class='match'>H<\/span><span class='match'>k<\/span>3<span class='match'>o<\/span><span class='match'>r<\/span><span class='match'>a<\/span><span class='match'>n<\/span><span class='match'>g<\/span><span class='match'>e<\/span>2<span class='match'>o<\/span>5<span class='match'>g<\/span><span class='match'>h<\/span><span class='match'>t<\/span><span class='match'>e<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]

???

* an uppercase letter will select everything BUT that thing (so `\D` doesn’t select digits, `\S` will erase blank spaces, and so on)

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - dot
### - qualifier
### - escape
### - meta
### - POSIX
]
.right-column[
## Regex
* `[:digit:]`: matches any digit.
* `[:space:]`: matches any whitespace.
* `[:alpha:]`: matches any alphabetic character.
* more on [?base::regex](https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html)

```r
str_view_all(string, "[:digit:]")
```

<div id="htmlwidget-1ca2cd66ca69a3a9a6c1" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-1ca2cd66ca69a3a9a6c1">{"x":{"html":"<ul>\n  <li>lzDHk<span class='match'>3<\/span>orange<span class='match'>2<\/span>o<span class='match'>5<\/span>ghte<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>

```r
str_view_all(string, "[:alpha:]")
```

<div id="htmlwidget-a846f8c2334de6fe4a8a" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-a846f8c2334de6fe4a8a">{"x":{"html":"<ul>\n  <li><span class='match'>l<\/span><span class='match'>z<\/span><span class='match'>D<\/span><span class='match'>H<\/span><span class='match'>k<\/span>3<span class='match'>o<\/span><span class='match'>r<\/span><span class='match'>a<\/span><span class='match'>n<\/span><span class='match'>g<\/span><span class='match'>e<\/span>2<span class='match'>o<\/span>5<span class='match'>g<\/span><span class='match'>h<\/span><span class='match'>t<\/span><span class='match'>e<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]

---

.left-column[
.center[[&lt;img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/stringr.png" width="60%"&gt;](http://stringr.tidyverse.org)]
### - dot
### - qualifier
### - escape
### - meta
### - POSIX
### - anchor
]
.right-column[
## Regex
* `^` matches the start of the string.
* `$` matches the end of the string.

```r
str_view_all(fruit, "a")
```

<div id="htmlwidget-8b19f661d891580c854b" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-8b19f661d891580c854b">{"x":{"html":"<ul>\n  <li>cherry<\/li>\n  <li>b<span class='match'>a<\/span>n<span class='match'>a<\/span>n<span class='match'>a<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
.pull-left[

```r
str_view_all(fruit, "a$")
```

<div id="htmlwidget-70af9ce0867070e73dd9" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-70af9ce0867070e73dd9">{"x":{"html":"<ul>\n  <li>cherry<\/li>\n  <li>banan<span class='match'>a<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]
.pull-right[

```r
str_view_all(fruit, "^a")
```

<div id="htmlwidget-bf1bb8635039ded10c36" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-bf1bb8635039ded10c36">{"x":{"html":"<ul>\n  <li>cherry<\/li>\n  <li>banana<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
]
]

---

class: inverse middle

## Text mining

---

## 🎼 Waiting for the Sun ☀️


```r
lyrics &lt;- c("This will be an uncertain time for us my love",
            "I can hear the echo of your voice in my head",
            "Singing my love",
            "I can see your face there in my hands my love",
            "I have been blessed by your grace and care my love",
            "Singing my love")
text_tbl &lt;- tibble(line = seq_along(lyrics), text = lyrics)
text_tbl
```

```
#&gt; # A tibble: 6 x 2
#&gt;    line text                                              
#&gt;   &lt;int&gt; &lt;chr&gt;                                             
#&gt; 1     1 This will be an uncertain time for us my love     
#&gt; 2     2 I can hear the echo of your voice in my head      
#&gt; 3     3 Singing my love                                   
#&gt; 4     4 I can see your face there in my hands my love     
#&gt; 5     5 I have been blessed by your grace and care my love
#&gt; 6     6 Singing my love
```

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - tokenise
]
.right-column[
## Unigram

```r
library(tidytext)
text_tbl %&gt;%
  unnest_tokens(output = word, input = text)
```

```
#&gt; # A tibble: 49 x 2
#&gt;    line word     
#&gt;   &lt;int&gt; &lt;chr&gt;    
#&gt; 1     1 this     
#&gt; 2     1 will     
#&gt; 3     1 be       
#&gt; 4     1 an       
#&gt; 5     1 uncertain
#&gt; 6     1 time     
#&gt; # … with 43 more rows
```
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - tokenise
]
.right-column[
## Unigram

```r
text_tbl %&gt;%
  unnest_tokens(output = word, input = text) %&gt;% 
  count(word, sort = TRUE)
```

```
#&gt; # A tibble: 32 x 2
#&gt;   word      n
#&gt;   &lt;chr&gt; &lt;int&gt;
#&gt; 1 my        7
#&gt; 2 love      5
#&gt; 3 i         3
#&gt; 4 your      3
#&gt; 5 can       2
#&gt; 6 in        2
#&gt; # … with 26 more rows
```
.brown[how often we see each word in this corpus]
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - tokenise
]
.right-column[

```r
text_tbl %&gt;%
  unnest_characters(output = word, input = text)
```

```
#&gt; # A tibble: 171 x 2
#&gt;    line word 
#&gt;   &lt;int&gt; &lt;chr&gt;
#&gt; 1     1 t    
#&gt; 2     1 h    
#&gt; 3     1 i    
#&gt; 4     1 s    
#&gt; 5     1 w    
#&gt; 6     1 i    
#&gt; # … with 165 more rows
```
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - tokenise
]
.right-column[
## N-gram

```r
text_tbl %&gt;%
  unnest_ngrams(output = word, input = text, n = 2)
```

```
#&gt; # A tibble: 43 x 2
#&gt;    line word          
#&gt;   &lt;int&gt; &lt;chr&gt;         
#&gt; 1     1 this will     
#&gt; 2     1 will be       
#&gt; 3     1 be an         
#&gt; 4     1 an uncertain  
#&gt; 5     1 uncertain time
#&gt; 6     1 time for      
#&gt; # … with 37 more rows
```
]

---

background-image: url(img/acnh-rstats.jpg)
background-size: contain

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
]
.right-column[
## Sentiment analysis
&lt;br&gt;
&lt;br&gt;
&lt;img src="https://www.tidytextmining.com/images/tmwr_0201.png" width="100%"&gt;
.footnote[image credit: [Text Mining with R](https://www.tidytextmining.com/sentiment.html)]
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
]
.right-column[
## sentiment analysis

```r
user_reviews &lt;- read_tsv(
  "data/animal-crossing/user_reviews.tsv")
user_reviews
```

```
#&gt; # A tibble: 2,999 x 4
#&gt;   grade user_name   text                          date      
#&gt;   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;                         &lt;date&gt;    
#&gt; 1     4 mds27272    My gf started playing before… 2020-03-20
#&gt; 2     5 lolo2178    While the game itself is gre… 2020-03-20
#&gt; 3     0 Roachant    My wife and I were looking f… 2020-03-20
#&gt; 4     0 Houndf      We need equal values and opp… 2020-03-20
#&gt; 5     0 ProfessorF… BEWARE!  If you have multipl… 2020-03-20
#&gt; 6     0 tb726       The limitation of one island… 2020-03-20
#&gt; # … with 2,993 more rows
```
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
]
.right-column[
## grade distribution

```r
user_reviews %&gt;% 
  ggplot(aes(grade)) +
  geom_bar()
```

&lt;img src="figure/acnh-grade-1.png" width="540" style="display: block; margin: auto;" /&gt;
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
]
.right-column[
## positive vs negative reviews
.pull-left[

```r
user_reviews %&gt;% 
  slice_max(grade, 
    with_ties = FALSE) %&gt;% 
  pull(text)
```

```
#&gt; [1] "Cant stop playing!"
```
]
.pull-right[

```r
user_reviews %&gt;% 
  slice_min(grade,
    with_ties = FALSE) %&gt;% 
  pull(text)
```

```
#&gt; My wife and I were looking
#&gt; forward to playing this game
#&gt; when it released. I bought
#&gt; it, I let her play first she
#&gt; made an island and played for
#&gt; a bit. Then I decided to play
#&gt; only to discover that Nintendo
#&gt; only allows one island per
#&gt; switch! Not only that, the
#&gt; second player cannot build
#&gt; anything on the island and
#&gt; tool building is considerably
#&gt; harder to do. So, if you have
#&gt; more than one personMy wife
#&gt; and I were looking forward
#&gt; to playing this game when it
#&gt; released. I bought it, I let
#&gt; her play first she made an
#&gt; island and played for a bit.
#&gt; Then I decided to play only
#&gt; to discover that Nintendo
#&gt; only allows one island per
#&gt; switch! Not only that, the
#&gt; second player cannot build
#&gt; anything on the island and
#&gt; tool building is considerably
#&gt; harder to do. So, if you have
#&gt; more than one person in your
#&gt; home that wants to play the
#&gt; game, you need two switches.
#&gt; Worst decision I have
#&gt; ever seen, this even beats
#&gt; EA.Congratulations Nintendo,
#&gt; you have officially become the
#&gt; worst video game company this
#&gt; year!… Expand
```
]
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
### - tokenise
]
.right-column[
## clean a bit from web scraping ...

```r
user_reviews_words &lt;- user_reviews %&gt;% 
  mutate(text = str_remove(text, "Expand$")) %&gt;% 
  unnest_tokens(output = word, input = text)
user_reviews_words
```

```
#&gt; # A tibble: 362,729 x 4
#&gt;   grade user_name date       word   
#&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;date&gt;     &lt;chr&gt;  
#&gt; 1     4 mds27272  2020-03-20 my     
#&gt; 2     4 mds27272  2020-03-20 gf     
#&gt; 3     4 mds27272  2020-03-20 started
#&gt; 4     4 mds27272  2020-03-20 playing
#&gt; 5     4 mds27272  2020-03-20 before 
#&gt; 6     4 mds27272  2020-03-20 me     
#&gt; # … with 362,723 more rows
```
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
### - tokenise
### - vis
]
.right-column[
## distribution of words per review

```r
user_reviews_words %&gt;% 
  count(user_name) %&gt;% 
  ggplot(aes(x = n)) +
  geom_histogram()
```

&lt;img src="figure/acnh-hist-1.png" width="540" style="display: block; margin: auto;" /&gt;
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
### - tokenise
### - vis
### - stop words
]
.right-column[
## the most common words

```r
user_reviews_words %&gt;%
  count(word, sort = TRUE)
```

```
#&gt; # A tibble: 13,454 x 2
#&gt;   word      n
#&gt;   &lt;chr&gt; &lt;int&gt;
#&gt; 1 the   17739
#&gt; 2 to    11857
#&gt; 3 game   8769
#&gt; 4 and    8740
#&gt; 5 a      8330
#&gt; 6 i      7211
#&gt; # … with 13,448 more rows
```
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
### - tokenise
### - vis
### - stop words
]
.right-column[
## lexicon
.pull-left[

```r
get_stopwords()
```

```
#&gt; # A tibble: 175 x 2
#&gt;   word   lexicon 
#&gt;   &lt;chr&gt;  &lt;chr&gt;   
#&gt; 1 i      snowball
#&gt; 2 me     snowball
#&gt; 3 my     snowball
#&gt; 4 myself snowball
#&gt; 5 we     snowball
#&gt; 6 our    snowball
#&gt; # … with 169 more rows
```
]
.pull-right[
1. In computing, stop words are words which are filtered out before or after processing of natural language data (text).
2. They usually refer to the most common words in a language, but there is not a single list of stop words used by all natural language processing tools.
]
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
### - tokenise
### - vis
### - stop words
]
.right-column[
## remove stop words

```r
stopwords_smart &lt;- get_stopwords(source = "smart")
user_reviews_smart &lt;- user_reviews_words %&gt;%
  anti_join(stopwords_smart)
user_reviews_smart
```

```
#&gt; # A tibble: 145,444 x 4
#&gt;   grade user_name date       word   
#&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;date&gt;     &lt;chr&gt;  
#&gt; 1     4 mds27272  2020-03-20 gf     
#&gt; 2     4 mds27272  2020-03-20 started
#&gt; 3     4 mds27272  2020-03-20 playing
#&gt; 4     4 mds27272  2020-03-20 option 
#&gt; 5     4 mds27272  2020-03-20 create 
#&gt; 6     4 mds27272  2020-03-20 island 
#&gt; # … with 145,438 more rows
```
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
### - tokenise
### - vis
### - stop words
### - count
]
.right-column[
## the most common words
.panelset[

.panel[.panel-name[Plot]

&lt;img src="figure/stop-words-smart-1.png" width="720" style="display: block; margin: auto;" /&gt;

.panel[.panel-name[Code]


```r
user_reviews_smart %&gt;%
  count(word) %&gt;%
  slice_max(n, n = 20) %&gt;% 
  ggplot(aes(x = n, y = fct_reorder(word, n))) +
  geom_col() +
  labs(x = "", y = "",
    title = "Frequency of words in user reviews")
```
]
]
]
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
### - tokenise
### - vis
### - stop words
### - count
### - sentiments
]
.right-column[
## sentiment lexicons
.pull-left[

```r
get_sentiments("afinn")
```

```
#&gt; # A tibble: 2,477 x 2
#&gt;   word       value
#&gt;   &lt;chr&gt;      &lt;dbl&gt;
#&gt; 1 abandon       -2
#&gt; 2 abandoned     -2
#&gt; 3 abandons      -2
#&gt; 4 abducted      -2
#&gt; 5 abduction     -2
#&gt; 6 abductions    -2
#&gt; # … with 2,471 more rows
```
]
.pull-right[

```r
get_sentiments("loughran")
```

```
#&gt; # A tibble: 4,150 x 2
#&gt;   word         sentiment
#&gt;   &lt;chr&gt;        &lt;chr&gt;    
#&gt; 1 abandon      negative 
#&gt; 2 abandoned    negative 
#&gt; 3 abandoning   negative 
#&gt; 4 abandonment  negative 
#&gt; 5 abandonments negative 
#&gt; 6 abandons     negative 
#&gt; # … with 4,144 more rows
```
]
]

???

One way to analyze the sentiment of a text is to consider the text as a combination of its individual words and the sentiment content of the whole text as the sum of the sentiment content of the individual words

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
### - tokenise
### - vis
### - stop words
### - count
### - sentiments
]
.right-column[
## sentiment lexicons

```r
sentiments_bing &lt;- get_sentiments("bing")
sentiments_bing
```

```
#&gt; # A tibble: 6,786 x 2
#&gt;   word       sentiment
#&gt;   &lt;chr&gt;      &lt;chr&gt;    
#&gt; 1 2-faces    negative 
#&gt; 2 abnormal   negative 
#&gt; 3 abolish    negative 
#&gt; 4 abominable negative 
#&gt; 5 abominably negative 
#&gt; 6 abominate  negative 
#&gt; # … with 6,780 more rows
```
]

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
### - tokenise
### - vis
### - stop words
### - count
### - sentiments
]
.right-column[
## join sentiments

```r
user_reviews_sentiments &lt;- user_reviews_words %&gt;%
  inner_join(sentiments_bing) %&gt;%
  count(sentiment, word, sort = TRUE)
user_reviews_sentiments
```

```
#&gt; # A tibble: 1,622 x 3
#&gt;   sentiment word         n
#&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;int&gt;
#&gt; 1 positive  like      1357
#&gt; 2 positive  fun        760
#&gt; 3 positive  great      661
#&gt; 4 positive  progress   556
#&gt; 5 positive  good       486
#&gt; 6 positive  enjoy      405
#&gt; # … with 1,616 more rows
```
]

???

why I use `inner_join()` here

---

.left-column[
.center[&lt;img src="https://github.com/juliasilge/tidytext/raw/master/man/figures/tidytext.png"&gt;]
### - import
### - glimpse
### - tokenise
### - vis
### - stop words
### - count
### - sentiments
### - vis
]
.right-column[
## visualise sentiments

.panelset[

.panel[.panel-name[Plot]

&lt;img src="figure/plot-sentiments-1.png" width="720" style="display: block; margin: auto;" /&gt;

.panel[.panel-name[Code]


```r
user_reviews_sentiments %&gt;%
  group_by(sentiment) %&gt;%
  slice_max(n, n = 10) %&gt;%
  ungroup() %&gt;%
  ggplot(aes(x = n, y = fct_reorder(word, n), 
    fill = sentiment)) +
  geom_col() +
  facet_wrap(~ sentiment, scales = "free") +
  labs(x = "", y = "",
    title = "Sentiments in user reviews")
```
]
]
]
]

---

## Reading

.pull-left[
.center[[&lt;img src="https://d33wubrfki0l68.cloudfront.net/b88ef926a004b0fce72b2526b0b5c4413666a4cb/24a30/cover.png" height="380px"&gt;](https://r4ds.had.co.nz)]
* [Strings](https://r4ds.had.co.nz/strings.html)
* [{stringr} cheatsheet](https://github.com/rstudio/cheatsheets/blob/master/strings.pdf)
]
.pull-right[
.center[[&lt;img src="https://www.tidytextmining.com/images/cover.png" height="380px"&gt;](https://www.tidytextmining.com/index.html)]
* [Sentiment analysis with tidy data](https://www.tidytextmining.com/sentiment.html)
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
