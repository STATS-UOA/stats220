---
title: "STATS 220"
subtitle: "Data import`r emo::ji('arrow_down')`/export`r emo::ji('arrow_up')`"
type: "lecture"
date: ""
output:
  xaringan::moon_reader:
    css: ["assets/remark.css"]
    lib_dir: libs
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r initial, echo = FALSE, cache = FALSE, results = 'hide'}
library(knitr)
options(htmltools.dir.version = FALSE, tibble.width = 60, tibble.print_min = 6)
opts_chunk$set(
  echo = TRUE, warning = FALSE, message = FALSE, comment = "#>",
  fig.path = 'figure/', cache.path = 'cache/', cache = TRUE,
  fig.align = 'center', fig.width = 12, fig.height = 8.5, fig.show = 'hold',
  dpi = 120
)
```

```{r xaringan-panelset, echo = FALSE}
xaringanExtra::use_panelset()
```

```{r external, include = FALSE, cache = FALSE}
read_chunk('R/02-import-export.R')
```

## Learning objectives

* Fundamental data structures
  1. tibbles/data frames
  2. matrix
  3. list
* Reading data files into R
* Writing to a file into disk

---

class: inverse middle

## Fundamental data structures in R

### 1. Lists

### 2. Matrices and arrays

### 3. Data frames and tibbles

---

.left-column[
## data strs
### - lists
]
.right-column[
An object contains elements of different data types.
```{r lists}
```
]

---

.left-column[
## data strs
### - lists
]
.right-column[
<img src="https://d33wubrfki0l68.cloudfront.net/9628eed602df6fd55d9bced4fba0a5a85d93db8a/36c16/diagrams/vectors/list.png" width="100%">
.pull-left[
## data type
```{r lists-type}
```
## data class
```{r lists-cls}
```
]
.pull-right[
## data structure
```{r lists-str}
```
]
]

---

.left-column[
## data strs
### - lists
]
.right-column[
A list can contain other lists, i.e. **recursive**
```{r lists-rec}
```
]

---

.left-column[
## data strs
### - lists
]
.right-column[
.pull-left[
Test for a list
```{r is-list}
```
]
.pull-right[
Coerce to a list
```{r as-list}
```
]
]

---

.left-column[
## data strs
### - lists
### - matrices
]
.right-column[
2D structure of homogeneous data types
* `matrix()` to construct a matrix
```{r matrix}
```
* `as.matrix()` to coerce to a matrix
* `is.matrix()` to test for a matrix
]

---

.left-column[
## data strs
### - lists
### - matrices
]
.right-column[
**array**: more than 2D matrix
```{r array}
```
]

---

.left-column[
## data strs
### - lists
### - matrices
### - tibbles
]
.right-column[
A data frame is a named **list** of vectors of the **same length**.
```{r data-frame}
```
]

---

.left-column[
## data strs
### - lists
### - matrices
### - tibbles
]
.right-column[
The underlying data type is a list.
```{r df-type}
```
.pull-left[
.center[data class]
```{r df-cls}
```
]
.pull-right[
.center[data attribute]
```{r df-attrs}
```
]
]

---

.left-column[
## data strs
### - lists
### - matrices
### - tibbles
]
.right-column[
A tibble is a modern reimagining of the data frame.
```{r tibbles, highlight.output = c(1, 3)}
```
* `as_tibble()` to coerce to a tibble
* `is_tibble()` to test for a tibble
]

---

.left-column[
## data strs
### - lists
### - matrices
### - tibbles
]
.right-column[
.center[
<img src="https://d33wubrfki0l68.cloudfront.net/9ec5e1f8982238a413847eb5c9bbc5dcf44c9893/bc590/diagrams/vectors/summary-tree-s3-2.png" width="250">
]
```{r tbl-type}
```
]

---

class: inverse middle

# Data import `r emo::ji('arrow_down')`

---

A diagram for local disk/remote cloud to RAM

---

.left-column[
readr logo
]
.right-column[
## Reading plain-text rectangular files
### .small[(a.k.a. flat or spreadsheet-like files)]
* delimited text files with `read_delim()`
  + `.csv`: comma separated values with `read_csv()`
  + `.tsv`: tab separated values `read_tsv()`
* `.fwf`: fixed width files with `read_fwf()`
<hr>
```{bash pisa-header}
head -4 data/pisa/pisa-student.csv # shell command, not R
```
]

---

.left-column[
readr logo
]
.right-column[
## Reading comma delimited files
```{r read-csv}
```
]

---

.left-column[
vroom logo
]
.right-column[
## Faster delimited reader at **1.4GB/sec**

.center[![](https://github.com/r-lib/vroom/raw/gh-pages/taylor.gif)]

```{r vroom, eval = FALSE}
```
]

---

.left-column[
readxl logo
]
.right-column[
## Reading proprietary binary files
* Microsoft Excel
  + `.xls`: MSFT Excel 2003 and earlier
  + `.xlsx`: MSFT Excel 2007 and later
```{r excel}
```
]

---

.left-column[
haven logo
]
.right-column[
## Reading proprietary binary files
* SAS
  + `.sas7bdat` with `read_sas()`
* Stata
  + `.dta` with `read_dta()`
* SPSS
  + `.sav` with `read_sav()`
```{r haven, eval = FALSE}
```
<hr>
Raw PISA data is made available in SAS and SPSS data formats.
.footnote[
data source: [https://www.oecd.org/pisa/data/2018database/](https://www.oecd.org/pisa/data/2018database/)
]
]

---

## Database

## Database management systems

---

.left-column[
## {DBI}
]
.right-column[
## Connecting R to database
```{r database, cache = FALSE}
```
]

---

.left-column[
## {DBI}
]
.right-column[
## Connecting R to database
* reading data from database
```{r db-read, cache = FALSE}
```

* writing SQL queries to read chunks
```{r db-query, cache = FALSE}
```

* closing connection
```{r db-close, cache = FALSE}
```
]

---

.left-column[
## {readr}
]
.right-column[
## Reading chunks for larger than memory data
```{r chunked, eval = FALSE}
```
]

---

.left-column[
## {jsonlite}
]
.right-column[
## JSON: JavaScript Object Notation
.pull-left[
### `.json`
```json
{
  "firstName": "Earo",
  "lastName": "Wang",
  "address": {
    "city": "Auckland",
    "postalCode": 1010
  }
}
```
]
.pull-right[
### R list
```r
list(
  firstName = "Earo",
  lastName = "Wang",
  address = list(
    city = "Auckland",
    postalCode = 1010
  )
)
```
]
]

---

.left-column[
## {jsonlite}
]
.right-column[
## JSON: JavaScript Object Notation
```{r json}
```
]

---

## spatial maps, audio, images, etc

---

## Writing to a file

---

## Reading

.pull-left[
.center[[<img src="https://d33wubrfki0l68.cloudfront.net/b88ef926a004b0fce72b2526b0b5c4413666a4cb/24a30/cover.png" height="520px">](https://r4ds.had.co.nz)]
]
.pull-right[
* [Chapter 10: Tibbles](https://r4ds.had.co.nz/tibbles.html)
* [Chapter 11: Data import](https://r4ds.had.co.nz/data-import.html)
]
